{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Training Submissions</h2>

  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Email</th>
          <th>User</th>
          <th>Training</th>
          <th>Date</th>
          <th>Status</th>
          <th>Created</th>
          <th style="width:110px">Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for row in rows.items %}
        <tr>
          <td>{{ row.id }}</td>
          <td>{{ row.email }}</td>
          <td>{{ row.user }}</td>
          <td>{{ row.training }}</td>
          <td>{{ row.train_date }}</td>
          <td>
            <span class="badge 
              {% if row.status == 'Complete' %} bg-success
              {% elif row.status == 'Pending' %} bg-warning text-dark
              {% else %} bg-secondary {% endif %}
            ">
              {{ row.status }}
            </span>
          </td>
          <td>{{ row.created_at }}</td>     
          <td>
            <form action="{{ url_for('delete_training_submission', submission_id=row.id, page=rows.page) }}"
                  method="post" class="d-inline"
                  onsubmit="return confirm('Delete submission #{{ row.id }}?');">

              {# --- OPTION A: Flask‑WTF form object (if you passed one into the template) --- #}
              {# {{ form.csrf_token }} #}

              {# --- OPTION B: Using csrf_token() helper (Flask‑WTF without a form object) --- #}
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

              <button type="submit" class="btn btn-sm btn-outline-danger">
                Delete
              </button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-3">
      {% if rows.has_prev %}
        <li class="page-item">
          <a class="page-link" href="?page={{ rows.prev_num }}">Previous</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link">Page {{ rows.page }} of {{ rows.pages }}</span>
      </li>

      {% if rows.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ rows.next_num }}">Next</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
</div>
<!-- Delete all shown rows (current page/filter) -->
<form
  method="post"
  action="{{ url_for('bulk_delete_training_submissions') }}"
  onsubmit="return confirm('Delete ALL items currently listed on this page? This cannot be undone.');"
  class="d-flex justify-content-center mt-3"
>
  <input type="hidden" name="scope" value="current_view">
  <input type="hidden" name="page" value="{{ rows.page }}">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <button type="submit" class="btn btn-danger">
    Delete All on This Page
  </button>
</form>
{% endblock %}

{% block scripts %}
    <script>
(function () {
  const msg = sessionStorage.getItem('toast');
  if (msg) {
    successToast(msg);
    sessionStorage.removeItem('toast');
  }
})();
</script>
    
{% endblock %}
